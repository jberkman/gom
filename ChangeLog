2008-02-24  jacob berkman  <jacob@ilovegom.org>

	* include/gom/dom/Makefile.inc: 
	* include/gom/Makefile.inc: 
	* src/libgom/Makefile.inc: 
	* src/gom/Makefile.inc: 
	* Makefile.am:
	* Makefile.inc: split Makefile.inc into its component pieces

	* configure.ac: look for check

	* examples/console.gom: use some of the new stuff below

	* src/libgom/gomjsobject.c (object_get_closure_prop)
	(object_set_closure_prop): add a lookup for closures stored as
	properties named onsignal
	(gom_js_object_resolve): look up the GParamSpec or signal id on an
	object for a named property
	(object_get_prop): if the property is a gobject property, return
	its value.  if it's a signal, look up the func associated with its
	closure, if it exists
	(object_set_prop): setter as above
	(object_resolve): if the property exists, add it as a property to
	this object
	(gom_js_object_construct, gom_js_object_init_class): as below

	* src/libgom/gomjselement.c (element_construct)
	(gom_js_element_init_class): as below

	* src/libgom/gomjsnode.c (node_construct, gom_js_node_init_class):
	same as below

	* src/libgom/gomjsdocument.c (document_construct): add dummy
	constructor
	(gom_js_document_init_class): the proto should be constructed,
	pass our constructor to JS_InitClass

	* src/gom/gom.c (parse_idle): run in window's context, not jsdoc's

	* src/libgom/gomvalue.[ch] (gom_jsval): convert a GValue to a
	jsval
	(gom_g_value): convert a jsval to a GValue

2008-02-22  jacob berkman  <jacob@ilovegom.org>

	* src/libgom/gomjselement.c (element_get_attribute): use
	JS_ConvertArguments() as below
	(element_set_attribute): finish a correct implementation for
	setting event handlers via setAttribute(); this will probably be
	removed soon

	* src/libgom/gomdoc.c (gom_dom_parser_start_element): refactor to
	reduce indenting levels

	* src/libgom/gomjswindow.c (window_alert): use
	JS_ConvertArguments() instead of manually marshaling the js
	arguments

2008-02-21  jacob berkman  <jacob@ilovegom.org>

	* examples/console.gom: quit when the window is closed

	* src/libgom/gomjsobject.c (gom_js_closure_marshal): better
	handling for callbacks that return void

	* examples/console.gom: beginnings of a gui js console app

	* src/libgom/gomjselement.c (element_set_attribute): handle jsvals
	that aren't strings properly

	* src/libgom/gomdoc.c (gom_dom_parser_text): remove some debugging
	output
	(gom_dom_parser_error): remove, this was not useful
	
	* src/libgom/gomjswindow.c (window_alert): implement window.alert()

	* src/libgom/gomwidget.c (PRIV, free_priv, init_priv): add a
	private struct to store attrs instead of using _set_data/_get_data
	as we have no idea what the types of those data are
	(widget_append_child): use new priv struct to look for container
	child properties of the widget being added
	(widget_find_property): remove.  g_object_class_find_property()
	can do this all on its own
	(widget_get_attribute): initial implementation; use priv table if
	available
	(widget_set_attribute): store property in priv table if there
	isn't a property on the object
	(init_once_cb, gom_widget_init): switch to GOnce/g_once() as below

	* src/libgom/gomjsobject.c (gom_js_closure_marshal): use
	G_VALUE_TYPE_NAME() instead of g_type_name(G_VALUE_TYPE())

	* src/libgom/*.c: add GOM_NOT_IMPLEMENTED macros where appropriate

	* include/gommacros.h (GOM_NOT_IMPLEMENTED): macro to print a
	warning on functions that are not yet implemented
	(_GOM_DEFINE_INTERFACE_BEGIN, _GOM_DEFINE_INTERFACE_END): use
	GOnce/g_once() instead of g_once_init_enter(), as the latter has
	different signatures on my mac and linux machines

2008-02-17  jacob berkman  <jacob@ilovegom.org>

	* src/libgom/gomdoc.c (gom_dom_parser_start_element): compile the
	function here before trying to connect the signal
	(gom_doc_parse_file): take a filename instead of a string

	* src/libgom/gomjsobject.c (gom_js_object_finalize): use
	gom_js_object_get_g_object() to get the GObject for this JSObject
	(gom_js_closure_new, gom_js_object_connect): take a JSFunction
	instead of a script

	* src/gom/gom.c (parse_idle): move doc parsing here so scripts can
	quit(), and let gom_doc_parse_file() load the file
	(main): shutdown javascript runtime to catch refcount bugs

2008-02-17  jacob berkman  <jacob@ilovegom.org>

	* Gom 0.0 released
